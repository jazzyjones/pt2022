<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joaquim">
<meta name="dcterms.date" content="2022-12-19">

<title>Quarto_PT2022 - Plano de Trabalho - teste inicial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Quarto_PT2022</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#carregando-bibliotecas" id="toc-carregando-bibliotecas" class="nav-link active" data-scroll-target="#carregando-bibliotecas">Carregando bibliotecas</a></li>
  <li><a href="#locale-e-crs" id="toc-locale-e-crs" class="nav-link" data-scroll-target="#locale-e-crs"><em>locale</em> e <em>crs</em></a></li>
  <li><a href="#áreas-urbanizadas-2015" id="toc-áreas-urbanizadas-2015" class="nav-link" data-scroll-target="#áreas-urbanizadas-2015">Áreas urbanizadas 2015</a></li>
  <li><a href="#municípios" id="toc-municípios" class="nav-link" data-scroll-target="#municípios">Municípios</a></li>
  <li><a href="#loop-de-geoprocessamento" id="toc-loop-de-geoprocessamento" class="nav-link" data-scroll-target="#loop-de-geoprocessamento"><em>loop</em> de geoprocessamento</a></li>
  <li><a href="#consolidação-da-tabela-de-cálculo-e-limpeza-da-memória" id="toc-consolidação-da-tabela-de-cálculo-e-limpeza-da-memória" class="nav-link" data-scroll-target="#consolidação-da-tabela-de-cálculo-e-limpeza-da-memória">Consolidação da tabela de cálculo e limpeza da memória</a></li>
  <li><a href="#somatório-das-áreas-por-setor-classe" id="toc-somatório-das-áreas-por-setor-classe" class="nav-link" data-scroll-target="#somatório-das-áreas-por-setor-classe">Somatório das áreas por setor / classe</a></li>
  <li><a href="#preparo-da-tabela-para-procedimento-de-otimização" id="toc-preparo-da-tabela-para-procedimento-de-otimização" class="nav-link" data-scroll-target="#preparo-da-tabela-para-procedimento-de-otimização">Preparo da tabela para procedimento de otimização</a></li>
  <li><a href="#declaração-das-variáveis-e-funcões-para-otimização" id="toc-declaração-das-variáveis-e-funcões-para-otimização" class="nav-link" data-scroll-target="#declaração-das-variáveis-e-funcões-para-otimização">Declaração das variáveis e funcões para otimização</a></li>
  <li><a href="#cálculo-dos-coeficientes---população---subdistrito" id="toc-cálculo-dos-coeficientes---população---subdistrito" class="nav-link" data-scroll-target="#cálculo-dos-coeficientes---população---subdistrito">Cálculo dos coeficientes - população - subdistrito</a></li>
  <li><a href="#cálculo-dos-coeficientes---domicílio---subdistrito" id="toc-cálculo-dos-coeficientes---domicílio---subdistrito" class="nav-link" data-scroll-target="#cálculo-dos-coeficientes---domicílio---subdistrito">Cálculo dos coeficientes - domicílio - subdistrito</a></li>
  <li><a href="#cálculo-dos-coeficientes---população---distrito" id="toc-cálculo-dos-coeficientes---população---distrito" class="nav-link" data-scroll-target="#cálculo-dos-coeficientes---população---distrito">Cálculo dos coeficientes - população - distrito</a></li>
  <li><a href="#cálculo-dos-coeficientes---domicílio---distrito" id="toc-cálculo-dos-coeficientes---domicílio---distrito" class="nav-link" data-scroll-target="#cálculo-dos-coeficientes---domicílio---distrito">Cálculo dos coeficientes - domicílio - distrito</a></li>
  <li><a href="#cálculo-dos-coeficientes---população---municípios" id="toc-cálculo-dos-coeficientes---população---municípios" class="nav-link" data-scroll-target="#cálculo-dos-coeficientes---população---municípios">Cálculo dos coeficientes - população - municípios</a></li>
  <li><a href="#cálculo-dos-coeficientes---domicílio---municípios" id="toc-cálculo-dos-coeficientes---domicílio---municípios" class="nav-link" data-scroll-target="#cálculo-dos-coeficientes---domicílio---municípios">Cálculo dos coeficientes - domicílio - municípios</a></li>
  <li><a href="#etapas-finais" id="toc-etapas-finais" class="nav-link" data-scroll-target="#etapas-finais">Etapas finais</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Plano de Trabalho - teste inicial</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joaquim </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 19, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="carregando-bibliotecas" class="level2">
<h2 class="anchored" data-anchor-id="carregando-bibliotecas">Carregando bibliotecas</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="locale-e-crs" class="level2">
<h2 class="anchored" data-anchor-id="locale-e-crs"><em>locale</em> e <em>crs</em></h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">##### Pesquisar depois e adaptar para utilizar o pacote geobr ao invés dos geopackages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">LANG =</span> <span class="st">"English"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># CRS para cálculo de áreas - </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A Diretoria de Geociências – DGC do IBGE através da Coordenação de Cartografia - CCAR, elaborou um estudo (FRANÇA e MARANHÃO, 2015)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># de geração de uma grade estatística para o Brasil buscando minimizar as distorções decorrentes da grande extensão territorial do país.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Neste contexto, foi feita a opção pela utilização da Projeção Equivalente de Albers, que apresenta como característica principal </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># a equivalência em área. Essa projeção é formada por um cone ao redor do globo, sob o qual as feições da superfície terrestre são </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># projetadas. Este cone intercepta o globo em dois paralelos padrão, com os meridianos formando linhas retas com a origem em um ponto</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># central na geratriz do cone, enquanto os paralelos formam círculos concêntricos em torno deste ponto. O datum horizontal adotado é o</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># SIRGAS2000.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Os parâmetros da projeção adotada são:</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Meridiano Central -54º</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude de Origem -12º</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 1º Paralelo Padrão -2º</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 2º Paralelo Padrão -22º</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Origem E: 5.000.000</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Origem N: 10.000.000</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Área de Abrangência canto inferior esquerdo (E,N):</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   2.800.000, 7.350.000</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># canto superior direito (E,N):</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   8.210.000, 12.200.000</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># https://spatialreference.org/ref/sr-org/albers-conical-equal-area-brazil-sirgas-2000/</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># +proj=aea +lat_1=-2 +lat_2=-22 +lat_0=-12 +lon_0=-54 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># endereço do arquivo geopackage com as camadas de amostragem para calculo dos coeficientes dos municípios</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>Proj_IBGE_area <span class="ot">&lt;-</span> <span class="st">'PROJCS["Conica_Equivalente_de_Albers_Brasil",</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="st">                         GEOGCS["GCS_SIRGAS2000",</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="st">                                DATUM["D_SIRGAS2000",</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="st">                                      SPHEROID["Geodetic_Reference_System_of_1980",6378137,298.2572221009113]],</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="st">                                PRIMEM["Greenwich",0],</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="st">                                UNIT["Degree",0.017453292519943295]],</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="st">                         PROJECTION["Albers"],</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="st">                         PARAMETER["standard_parallel_1",-2],</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="st">                         PARAMETER["standard_parallel_2",-22],</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="st">                         PARAMETER["latitude_of_origin",-12],</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="st">                         PARAMETER["central_meridian",-54],</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="st">                         PARAMETER["false_easting",5000000],</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="st">                         PARAMETER["false_northing",10000000],</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="st">                         UNIT["Meter",1]]'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="áreas-urbanizadas-2015" class="level2">
<h2 class="anchored" data-anchor-id="áreas-urbanizadas-2015">Áreas urbanizadas 2015</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Begin_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Carrega camada do Areas urbanizadas</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>AreasUrb2015 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"C:/ACELERADOR/Bases/AreasUrbanizadas2015.gpkg"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">query =</span> <span class="st">"SELECT Densidade, Tipo, CodConcUrb, geom FROM AreasUrbanizadas2015_CorrecaoTopologia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading query `SELECT Densidade, Tipo, CodConcUrb, geom FROM AreasUrbanizadas2015_CorrecaoTopologia'
from data source `C:\ACELERADOR\Bases\AreasUrbanizadas2015.gpkg' using driver `GPKG'
Simple feature collection with 13712 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XYZ
Bounding box:  xmin: -67.95836 ymin: -32.50709 xmax: -34.79333 ymax: 3.199139
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  SIRGAS 2000</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Tempo_areasurb <span class="ot">&lt;-</span> end_time <span class="sc">-</span> Begin_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="municípios" class="level2">
<h2 class="anchored" data-anchor-id="municípios">Municípios</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Carrega camada dos municípios</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Municipios <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"C:/ACELERADOR/Bases/MUNICIPIOS.gpkg"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">layer =</span> <span class="st">"BRMUE250GC_SIR_2010"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BRMUE250GC_SIR_2010' from data source 
  `C:\ACELERADOR\Bases\MUNICIPIOS.gpkg' using driver `GPKG'
Simple feature collection with 5567 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -73.99045 ymin: -33.75208 xmax: -28.83591 ymax: 5.271841
Geodetic CRS:  SIRGAS 2000</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Repara erro de topologia dos municípios</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Municipios <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(Municipios)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleciona os municípios que interseccionam a camada de áreas urbanizadas (mapeados)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>Municipios_proc <span class="ot">&lt;-</span> Municipios[AreasUrb2015, op <span class="ot">=</span> st_intersects]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove a camada original de municípios para liberar memória</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Municipios)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger  (Mb) max used  (Mb)
Ncells 1405478 75.1    2574421 137.5  2574421 137.5
Vcells 7394988 56.5   45627689 348.2 52579498 401.2</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria a sequência de geocódigos dos municípios</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ListaMun <span class="ot">&lt;-</span> Municipios_proc<span class="sc">$</span>CD_GEOCODM</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ListaMun &lt;- Municipios_proc$CD_GEOCODM[Municipios_proc$NM_MUNICIP == "RIO DE JANEIRO"]</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ListaMun <span class="ot">&lt;-</span> ListaMun[<span class="dv">1</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ListaMun &lt;- c("2307700", "2304202") # município que tá dando erro</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ListaMun &lt;- c("3124104", "3136652", "3130101", "3106705", "3162922", "3109006", "3140159", "3165537", "3149309",</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#               "3118601", "3154606", "3129806", "3106200", "3162955", "3144805", "3171204", "3117876", "3137601",</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#               "3157807", "3156700", "3153905", "3154804", "3110004") ## BH</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>Tempo_municipios <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="loop-de-geoprocessamento" class="level2">
<h2 class="anchored" data-anchor-id="loop-de-geoprocessamento"><em>loop</em> de geoprocessamento</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria a lista vazia para receber os data.frames / sf interseccionados e com áreas calculadas</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># loop para intersecao das bases e calculo de areas</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ListaMun) {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seleciona e o município</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  Mun <span class="ot">&lt;-</span> Municipios_proc <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(CD_GEOCODM <span class="sc">==</span> i)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extrai a geometria do municipio e converte para texto</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  Mun_wkt <span class="ot">&lt;-</span> Mun <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_text</span>()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># carrega a grade estatistica filtrando com a geometria do municipio</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  grade <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"C:/ACELERADOR/Bases/GradeEstatistica.gpkg"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">query =</span> <span class="st">"SELECT ID_UNICO, POP, DOM_OCU, Shape_Area as AreaGrade, geom FROM GradeEstatistica"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">wkt_filter =</span> Mun_wkt)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># seleciona as celulas da grade que estejam completamente dentro do municipio</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  grade <span class="ot">&lt;-</span> grade[Mun, op <span class="ot">=</span> st_within]</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reprojeta a grade para coordenadas planas</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  grade <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grade, Proj_IBGE_area)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cria a query dos setores </span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  query_setor <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"SELECT CD_GEOCODI, CD_GEOCODS, CD_GEOCODD, CD_GEOCODM, NM_MUNICIP, UF, geom FROM 'SETORES CENSITÁRIOS' WHERE CD_GEOCODM = "</span>, i)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># carrega os setores censitarios do municipio</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  setores <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"C:/ACELERADOR/Bases/BASE_2010.gpkg"</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">query =</span> query_setor)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reprojeta os setores para coordenadas planas</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  setores <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(setores, Proj_IBGE_area)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># seleciona as áreas urbanizadas que interseccionem o município</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  areas_urb <span class="ot">&lt;-</span> AreasUrb2015[Mun, op <span class="ot">=</span> st_intersects]</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reprojeta as áreas urbanizadas para coordenadas planas</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  areas_urb <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(areas_urb, Proj_IBGE_area)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># interseciona a grade com os setores </span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  intersecao <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(grade, setores)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># interseciona a camada de grade+setores com as areas urbanizadas</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  intersecao_urb <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(intersecao, areas_urb)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cria a camada diferenca de grade+setores com as areas urbanizdas</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  diferenca_urb <span class="ot">&lt;-</span> <span class="fu">st_difference</span>(intersecao, <span class="fu">st_union</span>(areas_urb))</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># junta as duas camadas - grade+setores+areas urbanizadas e grade+setor-areas urbanizadas</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  intersecao <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(intersecao_urb, diferenca_urb)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calcula as áreas dos segmentos resultantes</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  tabela_areas <span class="ot">&lt;-</span> intersecao <span class="sc">%&gt;%</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Area_Inter =</span> <span class="fu">st_area</span>(intersecao))</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exporta para um geopackage para avaliação</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_write</span>(<span class="fu">st_transform</span>(tabela_areas, <span class="at">crs =</span> <span class="dv">4674</span>), <span class="at">dsn =</span> <span class="st">"C:/ACELERADOR/EsPop_coef.gpkg"</span>, <span class="at">layer =</span> i, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># converte para numeros, sem unidade</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributes</span>(tabela_areas<span class="sc">$</span>Area_Inter) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove a geometria para liberar memoria</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>(tabela_areas) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>()</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># insere na lista de tabelas</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  TabelaCalcCoef[[i]] <span class="ot">=</span> tabela_areas</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading query `SELECT ID_UNICO, POP, DOM_OCU, Shape_Area as AreaGrade, geom FROM GradeEstatistica'
from data source `C:\ACELERADOR\Bases\GradeEstatistica.gpkg' using driver `GPKG'
Simple feature collection with 28844 features and 4 fields (with 15053 geometries empty)
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -69.36849 ymin: -10.49227 xmax: -67.47519 ymax: -9.50236
Geodetic CRS:  SIRGAS 2000
Reading query `SELECT CD_GEOCODI, CD_GEOCODS, CD_GEOCODD, CD_GEOCODM, NM_MUNICIP, UF, geom FROM 'SETORES CENSITÁRIOS' WHERE CD_GEOCODM = 1200401'
from data source `C:\ACELERADOR\Bases\BASE_2010.gpkg' using driver `GPKG'
Simple feature collection with 341 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -69.36378 ymin: -10.48533 xmax: -67.48169 ymax: -9.505231
Geodetic CRS:  SIRGAS 2000
Deleting layer `1200401' using driver `GPKG'
Writing layer `1200401' to data source 
  `C:/ACELERADOR/EsPop_coef.gpkg' using driver `GPKG'
Writing 19256 features with 14 fields and geometry type 3D Unknown (any).</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Tempo_geoproc <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="consolidação-da-tabela-de-cálculo-e-limpeza-da-memória" class="level2">
<h2 class="anchored" data-anchor-id="consolidação-da-tabela-de-cálculo-e-limpeza-da-memória">Consolidação da tabela de cálculo e limpeza da memória</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># consolida a tabela de calculo a partir da lista de tabelas</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(TabelaCalcCoef)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># limpa a memoria de objetos não mais necessarios</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = setdiff(ls(), c("TabelaCalcCoef", "ListaMun", "Begin_time", "start_time", "Tempo_areasurb", "Tempo_municipios", "Tempo_geoproc")))</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger  (Mb) max used  (Mb)
Ncells 1622239 86.7    2574421 137.5  2574421 137.5
Vcells 9172329 70.0   29201722 222.8 52579498 401.2</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Tempo_cons <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="somatório-das-áreas-por-setor-classe" class="level2">
<h2 class="anchored" data-anchor-id="somatório-das-áreas-por-setor-classe">Somatório das áreas por setor / classe</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove as unidades de área (m^2)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> <span class="fu">drop_units</span>(TabelaCalcCoef)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># soma as áreas totais dos setores por classe de densidade usando data.table</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(TabelaCalcCoef)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> (</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  TabelaCalcCoef</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  [, <span class="at">ClasseUrb :=</span> <span class="fu">fcase</span>(Tipo <span class="sc">==</span> <span class="st">"Área urbanizada"</span> <span class="sc">&amp;</span> Densidade <span class="sc">==</span> <span class="st">"Densa"</span>, <span class="st">"UrDs"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                        Tipo <span class="sc">==</span> <span class="st">"Área urbanizada"</span> <span class="sc">&amp;</span> Densidade <span class="sc">==</span> <span class="st">"Pouco densa"</span>, <span class="st">"UrPd"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                        Tipo <span class="sc">==</span> <span class="st">"Outros equipamentos urbanos"</span>, <span class="st">"NRes"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                        Tipo <span class="sc">==</span> <span class="st">"Vazio intraurbano"</span>, <span class="st">"Vaz"</span>, <span class="fu">is.na</span>(Tipo), <span class="st">"Vaz"</span>)]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  [ClasseUrb <span class="sc">==</span> <span class="st">"UrDs"</span>, <span class="at">AreUrDsSet :=</span> <span class="fu">sum</span>(Area_Inter), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  [ClasseUrb <span class="sc">==</span> <span class="st">"UrPd"</span>, <span class="at">AreUrPdSet :=</span> <span class="fu">sum</span>(Area_Inter), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  [ClasseUrb <span class="sc">==</span> <span class="st">"NRes"</span>, <span class="at">AreNResSet :=</span> <span class="fu">sum</span>(Area_Inter), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  [ClasseUrb <span class="sc">==</span> <span class="st">"Vaz"</span>, <span class="at">AreaVazSet :=</span> <span class="fu">sum</span>(Area_Inter), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  [<span class="fu">is.na</span>(AreUrDsSet), <span class="at">AreUrDsSet :=</span> <span class="dv">0</span>]</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  [<span class="fu">is.na</span>(AreUrPdSet), <span class="at">AreUrPdSet :=</span> <span class="dv">0</span>]</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  [<span class="fu">is.na</span>(AreNResSet), <span class="at">AreNResSet :=</span> <span class="dv">0</span>]</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  [<span class="fu">is.na</span>(AreaVazSet), <span class="at">AreaVazSet :=</span> <span class="dv">0</span>]</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  [, <span class="at">AreUrDsSet :=</span> <span class="fu">max</span>(AreUrDsSet), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  [, <span class="at">AreUrPdSet :=</span> <span class="fu">max</span>(AreUrPdSet), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  [, <span class="at">AreNResSet :=</span> <span class="fu">max</span>(AreNResSet), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  [, <span class="at">AreaVazSet :=</span> <span class="fu">max</span>(AreaVazSet), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>Tempo_calcarea <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="preparo-da-tabela-para-procedimento-de-otimização" class="level2">
<h2 class="anchored" data-anchor-id="preparo-da-tabela-para-procedimento-de-otimização">Preparo da tabela para procedimento de otimização</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove segmentos sem associacao com grade ou setor (problemas de topologia)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(TabelaCalcCoef, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"CD_GEOCODI"</span>, <span class="st">"ID_UNICO"</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria lista de setores</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>ListaSet <span class="ot">&lt;-</span> <span class="fu">unique</span>(TabelaCalcCoef<span class="sc">$</span>CD_GEOCODI)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(ListaSet, <span class="at">collapse =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "120040105000112, 120040105000113, 120040105000114, 120040105000115, 120040105000116, 120040105000179, 120040105000181, 120040105000182, 120040105000183, 120040105000184, 120040105000185, 120040105000186, 120040105000187, 120040105000188, 120040105000189, 120040105000190, 120040105000191, 120040105000192, 120040105000193, 120040105000194, 120040105000195, 120040105000196, 120040105000197, 120040105000198, 120040105000199, 120040105000200, 120040105000201, 120040105000202, 120040105000203, 120040105000204, 120040105000205, 120040105000206, 120040105000207, 120040105000208, 120040105000209, 120040105000210, 120040105000211, 120040105000212, 120040105000213, 120040105000214, 120040105000215, 120040105000216, 120040105000217, 120040105000235, 120040105000236, 120040105000237, 120040105000247, 120040105000252, 120040105000297, 120040105000298, 120040105000299, 120040105000300, 120040105000301, 120040105000302, 120040105000317, 120040105000318, 120040105000325, 120040105000326, 120040105000327, 120040105000334, 120040105000336, 120040105000341, 120040105000101, 120040105000102, 120040105000103, 120040105000104, 120040105000105, 120040105000106, 120040105000107, 120040105000108, 120040105000109, 120040105000110, 120040105000111, 120040105000001, 120040105000002, 120040105000003, 120040105000004, 120040105000005, 120040105000006, 120040105000007, 120040105000008, 120040105000009, 120040105000010, 120040105000011, 120040105000012, 120040105000013, 120040105000014, 120040105000015, 120040105000016, 120040105000017, 120040105000018, 120040105000019, 120040105000020, 120040105000021, 120040105000022, 120040105000023, 120040105000024, 120040105000025, 120040105000026, 120040105000027, 120040105000028, 120040105000029, 120040105000030, 120040105000031, 120040105000032, 120040105000033, 120040105000034, 120040105000035, 120040105000036, 120040105000037, 120040105000038, 120040105000039, 120040105000040, 120040105000041, 120040105000042, 120040105000043, 120040105000044, 120040105000045, 120040105000046, 120040105000047, 120040105000048, 120040105000049, 120040105000050, 120040105000051, 120040105000052, 120040105000053, 120040105000054, 120040105000055, 120040105000057, 120040105000058, 120040105000059, 120040105000060, 120040105000061, 120040105000062, 120040105000063, 120040105000064, 120040105000065, 120040105000066, 120040105000067, 120040105000068, 120040105000069, 120040105000070, 120040105000071, 120040105000072, 120040105000073, 120040105000074, 120040105000075, 120040105000076, 120040105000077, 120040105000078, 120040105000079, 120040105000080, 120040105000081, 120040105000082, 120040105000083, 120040105000084, 120040105000085, 120040105000086, 120040105000092, 120040105000093, 120040105000094, 120040105000095, 120040105000096, 120040105000097, 120040105000098, 120040105000099, 120040105000100, 120040105000117, 120040105000118, 120040105000119, 120040105000120, 120040105000121, 120040105000122, 120040105000123, 120040105000124, 120040105000125, 120040105000126, 120040105000127, 120040105000128, 120040105000129, 120040105000130, 120040105000131, 120040105000132, 120040105000134, 120040105000135, 120040105000136, 120040105000137, 120040105000138, 120040105000139, 120040105000140, 120040105000157, 120040105000158, 120040105000159, 120040105000160, 120040105000161, 120040105000162, 120040105000163, 120040105000164, 120040105000165, 120040105000166, 120040105000167, 120040105000168, 120040105000169, 120040105000170, 120040105000171, 120040105000172, 120040105000173, 120040105000177, 120040105000178, 120040105000180, 120040105000222, 120040105000223, 120040105000224, 120040105000225, 120040105000226, 120040105000227, 120040105000228, 120040105000230, 120040105000233, 120040105000248, 120040105000275, 120040105000277, 120040105000279, 120040105000281, 120040105000282, 120040105000283, 120040105000284, 120040105000285, 120040105000286, 120040105000287, 120040105000288, 120040105000293, 120040105000295, 120040105000296, 120040105000303, 120040105000338, 120040105000339, 120040105000145, 120040105000146, 120040105000147, 120040105000148, 120040105000149, 120040105000150, 120040105000151, 120040105000152, 120040105000153, 120040105000154, 120040105000155, 120040105000156, 120040105000174, 120040105000175, 120040105000176, 120040105000232, 120040105000234, 120040105000261, 120040105000290, 120040105000294, 120040105000141, 120040105000340, 120040105000133, 120040105000142, 120040105000143, 120040105000144, 120040105000229, 120040105000231, 120040105000289, 120040105000291, 120040105000292, 120040105000304, 120040105000305, 120040105000337, 120040105000242, 120040105000243, 120040105000244, 120040105000310, 120040105000311, 120040105000312, 120040105000314, 120040105000056, 120040105000087, 120040105000088, 120040105000089, 120040105000090, 120040105000091, 120040105000218, 120040105000219, 120040105000220, 120040105000221, 120040105000238, 120040105000241, 120040105000276, 120040105000278, 120040105000280, 120040105000328, 120040105000333, 120040105000239, 120040105000240, 120040105000246, 120040105000306, 120040105000307, 120040105000308, 120040105000309, 120040105000316, 120040105000258, 120040105000245, 120040105000315, 120040105000313, 120040105000335, 120040105000256, 120040105000332, 120040105000257, 120040105000249, 120040105000273, 120040105000319, 120040105000260, 120040105000259, 120040105000250, 120040105000251, 120040105000253, 120040105000254, 120040105000255, 120040105000262, 120040105000263, 120040105000264, 120040105000265, 120040105000266, 120040105000267, 120040105000268, 120040105000269, 120040105000270, 120040105000271, 120040105000272, 120040105000274, 120040105000320, 120040105000321, 120040105000322, 120040105000323, 120040105000324, 120040105000329, 120040105000330, 120040105000331"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cria a query com os geocodigos dos setores</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>query_set <span class="ot">&lt;-</span> <span class="fu">str_glue</span>(<span class="st">"SELECT Cod_setor, V001, V002 FROM 'Basico' WHERE Cod_setor IN ("</span>, <span class="fu">str_c</span>(ListaSet, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">")"</span>, <span class="at">collapse =</span> <span class="st">""</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Carrega a tabela de variáveis dos setores</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>VarSetores <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"C:/ACELERADOR/Bases/BASE_2010.gpkg"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">query =</span> query_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading query `SELECT Cod_setor, V001, V002 FROM 'Basico' WHERE Cod_setor IN (120040105000112, 120040105000113, 120040105000114, 120040105000115, 120040105000116, 120040105000179, 120040105000181, 120040105000182, 120040105000183, 120040105000184, 120040105000185, 120040105000186, 120040105000187, 120040105000188, 120040105000189, 120040105000190, 120040105000191, 120040105000192, 120040105000193, 120040105000194, 120040105000195, 120040105000196, 120040105000197, 120040105000198, 120040105000199, 120040105000200, 120040105000201, 120040105000202, 120040105000203, 120040105000204, 120040105000205, 120040105000206, 120040105000207, 120040105000208, 120040105000209, 120040105000210, 120040105000211, 120040105000212, 120040105000213, 120040105000214, 120040105000215, 120040105000216, 120040105000217, 120040105000235, 120040105000236, 120040105000237, 120040105000247, 120040105000252, 120040105000297, 120040105000298, 120040105000299, 120040105000300, 120040105000301, 120040105000302, 120040105000317, 120040105000318, 120040105000325, 120040105000326, 120040105000327, 120040105000334, 120040105000336, 120040105000341, 120040105000101, 120040105000102, 120040105000103, 120040105000104, 120040105000105, 120040105000106, 120040105000107, 120040105000108, 120040105000109, 120040105000110, 120040105000111, 120040105000001, 120040105000002, 120040105000003, 120040105000004, 120040105000005, 120040105000006, 120040105000007, 120040105000008, 120040105000009, 120040105000010, 120040105000011, 120040105000012, 120040105000013, 120040105000014, 120040105000015, 120040105000016, 120040105000017, 120040105000018, 120040105000019, 120040105000020, 120040105000021, 120040105000022, 120040105000023, 120040105000024, 120040105000025, 120040105000026, 120040105000027, 120040105000028, 120040105000029, 120040105000030, 120040105000031, 120040105000032, 120040105000033, 120040105000034, 120040105000035, 120040105000036, 120040105000037, 120040105000038, 120040105000039, 120040105000040, 120040105000041, 120040105000042, 120040105000043, 120040105000044, 120040105000045, 120040105000046, 120040105000047, 120040105000048, 120040105000049, 120040105000050, 120040105000051, 120040105000052, 120040105000053, 120040105000054, 120040105000055, 120040105000057, 120040105000058, 120040105000059, 120040105000060, 120040105000061, 120040105000062, 120040105000063, 120040105000064, 120040105000065, 120040105000066, 120040105000067, 120040105000068, 120040105000069, 120040105000070, 120040105000071, 120040105000072, 120040105000073, 120040105000074, 120040105000075, 120040105000076, 120040105000077, 120040105000078, 120040105000079, 120040105000080, 120040105000081, 120040105000082, 120040105000083, 120040105000084, 120040105000085, 120040105000086, 120040105000092, 120040105000093, 120040105000094, 120040105000095, 120040105000096, 120040105000097, 120040105000098, 120040105000099, 120040105000100, 120040105000117, 120040105000118, 120040105000119, 120040105000120, 120040105000121, 120040105000122, 120040105000123, 120040105000124, 120040105000125, 120040105000126, 120040105000127, 120040105000128, 120040105000129, 120040105000130, 120040105000131, 120040105000132, 120040105000134, 120040105000135, 120040105000136, 120040105000137, 120040105000138, 120040105000139, 120040105000140, 120040105000157, 120040105000158, 120040105000159, 120040105000160, 120040105000161, 120040105000162, 120040105000163, 120040105000164, 120040105000165, 120040105000166, 120040105000167, 120040105000168, 120040105000169, 120040105000170, 120040105000171, 120040105000172, 120040105000173, 120040105000177, 120040105000178, 120040105000180, 120040105000222, 120040105000223, 120040105000224, 120040105000225, 120040105000226, 120040105000227, 120040105000228, 120040105000230, 120040105000233, 120040105000248, 120040105000275, 120040105000277, 120040105000279, 120040105000281, 120040105000282, 120040105000283, 120040105000284, 120040105000285, 120040105000286, 120040105000287, 120040105000288, 120040105000293, 120040105000295, 120040105000296, 120040105000303, 120040105000338, 120040105000339, 120040105000145, 120040105000146, 120040105000147, 120040105000148, 120040105000149, 120040105000150, 120040105000151, 120040105000152, 120040105000153, 120040105000154, 120040105000155, 120040105000156, 120040105000174, 120040105000175, 120040105000176, 120040105000232, 120040105000234, 120040105000261, 120040105000290, 120040105000294, 120040105000141, 120040105000340, 120040105000133, 120040105000142, 120040105000143, 120040105000144, 120040105000229, 120040105000231, 120040105000289, 120040105000291, 120040105000292, 120040105000304, 120040105000305, 120040105000337, 120040105000242, 120040105000243, 120040105000244, 120040105000310, 120040105000311, 120040105000312, 120040105000314, 120040105000056, 120040105000087, 120040105000088, 120040105000089, 120040105000090, 120040105000091, 120040105000218, 120040105000219, 120040105000220, 120040105000221, 120040105000238, 120040105000241, 120040105000276, 120040105000278, 120040105000280, 120040105000328, 120040105000333, 120040105000239, 120040105000240, 120040105000246, 120040105000306, 120040105000307, 120040105000308, 120040105000309, 120040105000316, 120040105000258, 120040105000245, 120040105000315, 120040105000313, 120040105000335, 120040105000256, 120040105000332, 120040105000257, 120040105000249, 120040105000273, 120040105000319, 120040105000260, 120040105000259, 120040105000250, 120040105000251, 120040105000253, 120040105000254, 120040105000255, 120040105000262, 120040105000263, 120040105000264, 120040105000265, 120040105000266, 120040105000267, 120040105000268, 120040105000269, 120040105000270, 120040105000271, 120040105000272, 120040105000274, 120040105000320, 120040105000321, 120040105000322, 120040105000323, 120040105000324, 120040105000329, 120040105000330, 120040105000331)'
from data source `C:\ACELERADOR\Bases\BASE_2010.gpkg' using driver `GPKG'</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converte as variaveis populacao e domicilio para numerico e renomeia a variavel de geocodigo do setor</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>VarSetores <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(VarSetores)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>VarSetores <span class="ot">&lt;-</span> VarSetores[, <span class="st">':='</span>(<span class="at">V001 =</span> <span class="fu">as.numeric</span>(V001),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">V002 =</span> <span class="fu">as.numeric</span>(V002),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">CD_GEOCODI =</span> Cod_setor)]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Associa as variaveis domicilios e moradores dos setores a tabela de calculo</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> VarSetores[TabelaCalcCoef, on <span class="ot">=</span> <span class="st">"CD_GEOCODI"</span>]</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># assigna o valor 0 para os setores sem valor nas variáveis V001 e V002</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> (</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  TabelaCalcCoef[<span class="fu">is.na</span>(V001), <span class="at">V001 :=</span> <span class="dv">0</span>]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  [<span class="fu">is.na</span>(V002), <span class="at">V002 :=</span> <span class="dv">0</span>]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria variaveis de controle de amostra e seleciona as colunas relevantes</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> (</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  TabelaCalcCoef</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  [, <span class="at">NC_Cont :=</span> <span class="fu">uniqueN</span>(ClasseUrb), <span class="at">by =</span> CD_GEOCODI]</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  [, <span class="at">grd_amostra :=</span> <span class="fu">fifelse</span>(<span class="fu">any</span>(NC_Cont <span class="sc">&gt;</span> <span class="dv">1</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">by =</span> ID_UNICO]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  [, <span class="st">':='</span> (<span class="at">N_SubD =</span> <span class="fu">uniqueN</span>(CD_GEOCODS), <span class="at">N_Dist =</span> <span class="fu">uniqueN</span>(CD_GEOCODD), <span class="at">N_Mun =</span> <span class="fu">uniqueN</span>(CD_GEOCODM)),<span class="at">by =</span> ID_UNICO]</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  [, .(CD_GEOCODI, CD_GEOCODS, CD_GEOCODD, CD_GEOCODM, NM_MUNICIP, UF, ID_UNICO, NC_Cont, grd_amostra, N_SubD, N_Dist, N_Mun,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>       POP, DOM_OCU, V001, V002, Area_Inter, ClasseUrb, AreUrDsSet, AreUrPdSet, AreNResSet, AreaVazSet)]</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ordena segundo o geocodigo do setor - crescente</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(TabelaCalcCoef, CD_GEOCODI)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co"># pivota a tabela, com o total das áreas por classe para cada segmento</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> <span class="fu">dcast</span>(TabelaCalcCoef, ... <span class="sc">~</span> ClasseUrb,</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fun =</span> sum,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value.var =</span> <span class="st">"Area_Inter"</span>,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="co"># verifica a existência das colunas de áreas por classe dos segmentos, e cria as faltantes com valor 0</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>colunas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"UrDs"</span>, <span class="st">"UrPd"</span>, <span class="st">"NRes"</span>, <span class="st">"Vaz"</span>)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="fu">setDF</span>(TabelaCalcCoef)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef[colunas[<span class="sc">!</span>(colunas <span class="sc">%in%</span> <span class="fu">colnames</span>(TabelaCalcCoef))]] <span class="ot">=</span> <span class="dv">0</span>  <span class="co"># semantica de Base R... devo tentar entender em algum momento</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(TabelaCalcCoef)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="co"># elimina segmentos que não pertencem à células da grade utilizadas na amostra - tabela final para calculo</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>TabelaCalcCoef <span class="ot">&lt;-</span> TabelaCalcCoef[grd_amostra <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Integrar a parte de calculo dos coeficientes</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>Tempo_tabela <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="declaração-das-variáveis-e-funcões-para-otimização" class="level2">
<h2 class="anchored" data-anchor-id="declaração-das-variáveis-e-funcões-para-otimização">Declaração das variáveis e funcões para otimização</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>par.ini <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>ubound <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>) <span class="co"># testar pra ver se resolve os erros</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>lbound <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">9</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">9</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">9</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">9</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Subd <span class="ot">&lt;-</span> <span class="fu">unique</span>(TabelaCalcCoef<span class="sc">$</span>CD_GEOCODS)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>Dist <span class="ot">&lt;-</span> <span class="fu">unique</span>(TabelaCalcCoef<span class="sc">$</span>CD_GEOCODD)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>Mun <span class="ot">&lt;-</span> <span class="fu">unique</span>(TabelaCalcCoef<span class="sc">$</span>CD_GEOCODM)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>SubD_coef_dpp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>Dist_coef_dpp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>Mun_coef_dpp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># função usando o data.table</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>fnopt_pop <span class="ot">&lt;-</span> <span class="cf">function</span>(par, data) {</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    [, <span class="at">POPEstTrecho :=</span> V002 <span class="sc">*</span> ((UrDs <span class="sc">*</span> par[<span class="dv">1</span>]) <span class="sc">+</span> (UrPd <span class="sc">*</span> par[<span class="dv">2</span>]) <span class="sc">+</span> (Vaz <span class="sc">*</span> par[<span class="dv">3</span>]) <span class="sc">+</span> (NRes <span class="sc">*</span> par[<span class="dv">4</span>]))</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      <span class="sc">/</span> ((AreUrDsSet <span class="sc">*</span> par[<span class="dv">1</span>]) <span class="sc">+</span> (AreUrPdSet <span class="sc">*</span> par[<span class="dv">2</span>]) <span class="sc">+</span> (AreaVazSet <span class="sc">*</span> par[<span class="dv">3</span>]) <span class="sc">+</span> (AreNResSet <span class="sc">*</span> par[<span class="dv">4</span>]))]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    [, .(<span class="at">POPEst =</span> <span class="fu">sum</span>(POPEstTrecho), <span class="at">POPGde =</span> <span class="fu">first</span>(POP)), <span class="at">by =</span> <span class="st">"ID_UNICO"</span>]</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    [, <span class="at">Erro :=</span> <span class="fu">abs</span>(POPGde <span class="sc">-</span> POPEst)]</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    [, .(<span class="at">total =</span> <span class="fu">sum</span>(Erro))]</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>fnopt_dom <span class="ot">&lt;-</span> <span class="cf">function</span>(par, data) {</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    [, <span class="at">DOMEstTrecho :=</span> V001 <span class="sc">*</span> ((UrDs <span class="sc">*</span> par[<span class="dv">1</span>]) <span class="sc">+</span> (UrPd <span class="sc">*</span> par[<span class="dv">2</span>]) <span class="sc">+</span> (Vaz <span class="sc">*</span> par[<span class="dv">3</span>]) <span class="sc">+</span> (NRes <span class="sc">*</span> par[<span class="dv">4</span>]))</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>      <span class="sc">/</span> ((AreUrDsSet <span class="sc">*</span> par[<span class="dv">1</span>]) <span class="sc">+</span> (AreUrPdSet <span class="sc">*</span> par[<span class="dv">2</span>]) <span class="sc">+</span> (AreaVazSet <span class="sc">*</span> par[<span class="dv">3</span>]) <span class="sc">+</span> (AreNResSet <span class="sc">*</span> par[<span class="dv">4</span>]))]</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    [, .(<span class="at">DOMEst =</span> <span class="fu">sum</span>(DOMEstTrecho), <span class="at">DOMGde =</span> <span class="fu">first</span>(DOM_OCU)), <span class="at">by =</span> <span class="st">"ID_UNICO"</span>]</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    [, <span class="at">Erro :=</span> <span class="fu">abs</span>(DOMGde <span class="sc">-</span> DOMEst)]</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    [, .(<span class="at">total =</span> <span class="fu">sum</span>(Erro))]</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>Tempo_vars <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cálculo-dos-coeficientes---população---subdistrito" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-dos-coeficientes---população---subdistrito">Cálculo dos coeficientes - população - subdistrito</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Subd) {</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  selecao <span class="ot">&lt;-</span> TabelaCalcCoef[N_SubD <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> CD_GEOCODS <span class="sc">==</span> i]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  amostra <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(selecao<span class="sc">$</span>ID_UNICO)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  result_pop <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">optim</span>(<span class="at">par =</span> par.ini, <span class="at">fn =</span> fnopt_pop, <span class="at">data =</span> selecao, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower =</span> lbound))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]] <span class="ot">=</span> <span class="fu">data.frame</span>(i)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>CD_GEOCODS <span class="ot">=</span> i</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>pop_coefDS_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">1</span>], <span class="cn">NA</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>pop_coefPD_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">2</span>], <span class="cn">NA</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>pop_coefVZ_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">3</span>], <span class="cn">NA</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>pop_coefNR_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">4</span>], <span class="cn">NA</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>amostra_SubD <span class="ot">=</span> amostra</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>Coefs_SubD_pop <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(SubD_coef_dpp) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CD_GEOCODS, amostra_SubD, pop_coefDS_SubD, pop_coefPD_SubD, pop_coefVZ_SubD, pop_coefNR_SubD)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>Tempo_subdist_pop <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cálculo-dos-coeficientes---domicílio---subdistrito" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-dos-coeficientes---domicílio---subdistrito">Cálculo dos coeficientes - domicílio - subdistrito</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Subd) {</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  selecao <span class="ot">&lt;-</span> TabelaCalcCoef[N_SubD <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> CD_GEOCODS <span class="sc">==</span> i]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  amostra <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(selecao<span class="sc">$</span>ID_UNICO)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  result_dom <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">optim</span>(<span class="at">par =</span> par.ini, <span class="at">fn =</span> fnopt_dom, <span class="at">data =</span> selecao, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower =</span> lbound))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]] <span class="ot">=</span> <span class="fu">data.frame</span>(i)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>CD_GEOCODS <span class="ot">=</span> i</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>dom_coefDS_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">1</span>], <span class="cn">NA</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>dom_coefPD_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">2</span>], <span class="cn">NA</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>dom_coefVZ_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">3</span>], <span class="cn">NA</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>dom_coefNR_SubD <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">4</span>], <span class="cn">NA</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  SubD_coef_dpp[[i]]<span class="sc">$</span>amostra_SubD <span class="ot">=</span> amostra</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>Coefs_SubD_dom <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(SubD_coef_dpp) <span class="sc">%&gt;%</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CD_GEOCODS, amostra_SubD, dom_coefDS_SubD, dom_coefPD_SubD, dom_coefVZ_SubD, dom_coefNR_SubD)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>Tempo_subdist_dom <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cálculo-dos-coeficientes---população---distrito" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-dos-coeficientes---população---distrito">Cálculo dos coeficientes - população - distrito</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Dist) {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  selecao <span class="ot">&lt;-</span> TabelaCalcCoef[N_Dist <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> CD_GEOCODD <span class="sc">==</span> i]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  amostra <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(selecao<span class="sc">$</span>ID_UNICO)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  result_pop <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">optim</span>(<span class="at">par =</span> par.ini, <span class="at">fn =</span> fnopt_pop, <span class="at">data =</span> selecao, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower =</span> lbound))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]] <span class="ot">=</span> <span class="fu">data.frame</span>(i)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>CD_GEOCODD <span class="ot">=</span> i</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>pop_coefDS_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">1</span>], <span class="cn">NA</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>pop_coefPD_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">2</span>], <span class="cn">NA</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>pop_coefVZ_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">3</span>], <span class="cn">NA</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>pop_coefNR_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">4</span>], <span class="cn">NA</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>amostra_Dist <span class="ot">=</span> amostra</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>Coefs_Dist_pop <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Dist_coef_dpp) <span class="sc">%&gt;%</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CD_GEOCODD, amostra_Dist, pop_coefDS_Dist, pop_coefPD_Dist, pop_coefVZ_Dist, pop_coefNR_Dist)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>Tempo_dist_pop <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cálculo-dos-coeficientes---domicílio---distrito" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-dos-coeficientes---domicílio---distrito">Cálculo dos coeficientes - domicílio - distrito</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Dist) {</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  selecao <span class="ot">&lt;-</span> TabelaCalcCoef[N_Dist <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> CD_GEOCODD <span class="sc">==</span> i]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  amostra <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(selecao<span class="sc">$</span>ID_UNICO)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  result_dom <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">optim</span>(<span class="at">par =</span> par.ini, <span class="at">fn =</span> fnopt_dom, <span class="at">data =</span> selecao, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower =</span> lbound))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]] <span class="ot">=</span> <span class="fu">data.frame</span>(i)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>CD_GEOCODD <span class="ot">=</span> i</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>dom_coefDS_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">1</span>], <span class="cn">NA</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>dom_coefPD_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">2</span>], <span class="cn">NA</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>dom_coefVZ_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">3</span>], <span class="cn">NA</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>dom_coefNR_Dist <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">4</span>], <span class="cn">NA</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  Dist_coef_dpp[[i]]<span class="sc">$</span>amostra_Dist <span class="ot">=</span> amostra</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>Coefs_Dist_dom <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Dist_coef_dpp) <span class="sc">%&gt;%</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CD_GEOCODD, amostra_Dist, dom_coefDS_Dist, dom_coefPD_Dist, dom_coefVZ_Dist, dom_coefNR_Dist)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>Tempo_dist_dom <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cálculo-dos-coeficientes---população---municípios" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-dos-coeficientes---população---municípios">Cálculo dos coeficientes - população - municípios</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Mun) {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  selecao <span class="ot">&lt;-</span> TabelaCalcCoef[N_Mun <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> CD_GEOCODM <span class="sc">==</span> i]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  amostra <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(selecao<span class="sc">$</span>ID_UNICO)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  result_pop <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">optim</span>(<span class="at">par =</span> par.ini, <span class="at">fn =</span> fnopt_pop, <span class="at">data =</span> selecao, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower =</span> lbound))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]] <span class="ot">=</span> <span class="fu">data.frame</span>(i)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>CD_GEOCODM <span class="ot">=</span> i</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>pop_coefDS_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">1</span>], <span class="cn">NA</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>pop_coefPD_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">2</span>], <span class="cn">NA</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>pop_coefVZ_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">3</span>], <span class="cn">NA</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>pop_coefNR_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_pop) <span class="sc">==</span> <span class="st">"list"</span>, result_pop<span class="sc">$</span>par[<span class="dv">4</span>], <span class="cn">NA</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>amostra_Mun <span class="ot">=</span> amostra</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>Coefs_Mun_pop <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Mun_coef_dpp) <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CD_GEOCODM, amostra_Mun, pop_coefDS_Mun, pop_coefPD_Mun, pop_coefVZ_Mun, pop_coefNR_Mun)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>Tempo_mun_pop <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cálculo-dos-coeficientes---domicílio---municípios" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-dos-coeficientes---domicílio---municípios">Cálculo dos coeficientes - domicílio - municípios</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Mun) {</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  selecao <span class="ot">&lt;-</span> TabelaCalcCoef[N_Mun <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> CD_GEOCODM <span class="sc">==</span> i]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  amostra <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(selecao<span class="sc">$</span>ID_UNICO)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  result_dom <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">optim</span>(<span class="at">par =</span> par.ini, <span class="at">fn =</span> fnopt_dom, <span class="at">data =</span> selecao, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">lower =</span> lbound))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]] <span class="ot">=</span> <span class="fu">data.frame</span>(i)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>CD_GEOCODM <span class="ot">=</span> i</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>dom_coefDS_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">1</span>], <span class="cn">NA</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>dom_coefPD_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">2</span>], <span class="cn">NA</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>dom_coefVZ_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">3</span>], <span class="cn">NA</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>dom_coefNR_Mun <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">class</span>(result_dom) <span class="sc">==</span> <span class="st">"list"</span>, result_dom<span class="sc">$</span>par[<span class="dv">4</span>], <span class="cn">NA</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  Mun_coef_dpp[[i]]<span class="sc">$</span>amostra_Mun <span class="ot">=</span> amostra</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>Coefs_Mun_dom <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Mun_coef_dpp) <span class="sc">%&gt;%</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CD_GEOCODM, amostra_Mun, dom_coefDS_Mun, dom_coefPD_Mun, dom_coefVZ_Mun, dom_coefNR_Mun)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>Tempo_mun_dom <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="etapas-finais" class="level2">
<h2 class="anchored" data-anchor-id="etapas-finais">Etapas finais</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">"Coefs_SubD_pop"</span>, <span class="st">"Coefs_SubD_dom"</span>, <span class="st">"Coefs_Dist_pop"</span>, <span class="st">"Coefs_Dist_dom"</span>, <span class="st">"Coefs_Mun_pop"</span>, <span class="st">"Coefs_Mun_dom"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"TabelaCalcCoef"</span>, <span class="st">"Tempo_areasurb"</span>, <span class="st">"Tempo_municipios"</span>, <span class="st">"Tempo_geoproc"</span>, <span class="st">"Tempo_tabela"</span>, <span class="st">"Tempo_vars"</span>, <span class="st">"Tempo_subdist_pop"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Tempo_subdist_dom"</span>, <span class="st">"Tempo_dist_pop"</span>, <span class="st">"Tempo_dist_dom"</span>, <span class="st">"Tempo_mun_pop"</span>, <span class="st">"Tempo_mun_dom"</span>, <span class="st">"Tempo_coefs"</span>, <span class="st">"Tempo_Total"</span>, <span class="st">"start_time"</span>, <span class="st">"Tempo_cons"</span>, <span class="st">"Tempo_calcarea"</span>, <span class="st">"Begin_time"</span>)))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>SubD_pop_erro <span class="ot">&lt;-</span> Coefs_SubD_pop<span class="sc">$</span>CD_GEOCODS[<span class="fu">is.na</span>(<span class="fu">c</span>(Coefs_SubD_pop<span class="sc">$</span>pop_coefDS_SubD))]</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>SubD_dom_erro <span class="ot">&lt;-</span> Coefs_SubD_dom<span class="sc">$</span>CD_GEOCODS[<span class="fu">is.na</span>(<span class="fu">c</span>(Coefs_SubD_dom<span class="sc">$</span>dom_coefDS_SubD))]</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>Dist_pop_erro <span class="ot">&lt;-</span> Coefs_Dist_pop<span class="sc">$</span>CD_GEOCODD[<span class="fu">is.na</span>(<span class="fu">c</span>(Coefs_Dist_pop<span class="sc">$</span>pop_coefDS_Dist))]</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>Dist_dom_erro <span class="ot">&lt;-</span> Coefs_Dist_dom<span class="sc">$</span>CD_GEOCODD[<span class="fu">is.na</span>(<span class="fu">c</span>(Coefs_Dist_dom<span class="sc">$</span>dom_coefDS_Dist))]</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>Mun_pop_erro <span class="ot">&lt;-</span> Coefs_Mun_pop<span class="sc">$</span>CD_GEOCODM[<span class="fu">is.na</span>(<span class="fu">c</span>(Coefs_Mun_pop<span class="sc">$</span>pop_coefDS_Mun))]</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>Mun_dom_erro <span class="ot">&lt;-</span> Coefs_Mun_dom<span class="sc">$</span>CD_GEOCODM[<span class="fu">is.na</span>(<span class="fu">c</span>(Coefs_Mun_dom<span class="sc">$</span>dom_coefDS_Mun))]</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(Coefs_SubD_pop, dsn = "W:/DGC_ACERVO_CGEO/PROJETOS_EM_ANDAMENTO/Cemaden/BOLSISTAS/Joaquim/_GPKG/EstPop.gpkg", layer = "Coefs_SubD_pop", append = FALSE)</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(Coefs_SubD_dom, dsn = "W:/DGC_ACERVO_CGEO/PROJETOS_EM_ANDAMENTO/Cemaden/BOLSISTAS/Joaquim/_GPKG/EstPop.gpkg", layer = "Coefs_SubD_dom", append = FALSE)</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(Coefs_Dist_pop, dsn = "W:/DGC_ACERVO_CGEO/PROJETOS_EM_ANDAMENTO/Cemaden/BOLSISTAS/Joaquim/_GPKG/EstPop.gpkg", layer = "Coefs_Dist_pop", append = FALSE)</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(Coefs_Dist_dom, dsn = "W:/DGC_ACERVO_CGEO/PROJETOS_EM_ANDAMENTO/Cemaden/BOLSISTAS/Joaquim/_GPKG/EstPop.gpkg", layer = "Coefs_Dist_dom", append = FALSE)</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(Coefs_Mun_pop, dsn = "W:/DGC_ACERVO_CGEO/PROJETOS_EM_ANDAMENTO/Cemaden/BOLSISTAS/Joaquim/_GPKG/EstPop.gpkg", layer = "Coefs_Mun_pop", append = FALSE)</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(Coefs_Mun_dom, dsn = "W:/DGC_ACERVO_CGEO/PROJETOS_EM_ANDAMENTO/Cemaden/BOLSISTAS/Joaquim/_GPKG/EstPop.gpkg", layer = "Coefs_Mun_dom", append = FALSE)</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>Tempo_coefs <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>Tempo_Total <span class="ot">&lt;-</span> end_time <span class="sc">-</span> Begin_time</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>Tempo_areasurb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 0.402061 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>Tempo_municipios</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 48.40663 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>Tempo_geoproc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 18.38137 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Tempo_cons</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 0.1253169 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Tempo_calcarea</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 0.04457402 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>Tempo_tabela</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 2.595865 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Tempo_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 0.0139761 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>Tempo_subdist_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 2.148308 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>Tempo_subdist_dom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.797491 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>Tempo_dist_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 2.157917 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>Tempo_dist_dom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.712999 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>Tempo_mun_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 2.170332 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>Tempo_mun_dom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.75027 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>Tempo_coefs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 0.01015401 secs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>Tempo_Total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.369149 mins</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>